# üöó Sistema Quando Trocar Pneus - Documenta√ß√£o Completa

> Sistema automatizado para gera√ß√£o de artigos t√©cnicos sobre "Quando Trocar Pneus" usando dados reais de ve√≠culos.

## üìã √çndice

-   [Vis√£o Geral](#-vis√£o-geral)
-   [Arquitetura](#-arquitetura)
-   [Instala√ß√£o](#-instala√ß√£o)
-   [Configura√ß√£o](#-configura√ß√£o)
-   [Comandos Dispon√≠veis](#-comandos-dispon√≠veis)
-   [Estrutura de Dados](#-estrutura-de-dados)
-   [Fluxo de Funcionamento](#-fluxo-de-funcionamento)
-   [Exemplos de Uso](#-exemplos-de-uso)
-   [Solu√ß√£o de Problemas](#-solu√ß√£o-de-problemas)
-   [Desenvolvimento](#-desenvolvimento)

## üéØ Vis√£o Geral

O **Sistema Quando Trocar Pneus** √© um m√≥dulo Laravel DDD que automatiza a gera√ß√£o de artigos t√©cnicos sobre manuten√ß√£o de pneus para ve√≠culos espec√≠ficos. O sistema processa dados reais de 965 ve√≠culos (carros e motocicletas) e gera conte√∫do estruturado compat√≠vel com templates WordPress.

### Caracter√≠sticas Principais

-   ‚úÖ **965 ve√≠culos reais** (carros e motocicletas)
-   ‚úÖ **Dados t√©cnicos precisos** (press√µes, medidas, √≥leos)
-   ‚úÖ **Compatibilidade total** com Template_Quando_Trocar_os_Pneus.blade.php
-   ‚úÖ **Arquitetura DDD** robusta e escal√°vel
-   ‚úÖ **Gera√ß√£o em duas etapas** (inicial + refinamento Claude)
-   ‚úÖ **Sistema de qualidade** autom√°tico
-   ‚úÖ **Cache inteligente** e performance otimizada

### Tecnologias

-   **Laravel** 10+ (PHP 8.1+)
-   **Arquitetura DDD** (Domain Driven Design)
-   **MySQL** para persist√™ncia
-   **JSON** para estrutura de conte√∫do
-   **Scheduled Tasks** para automa√ß√£o

---

## üèóÔ∏è Arquitetura

### Estrutura DDD

```
src/ContentGeneration/WhenToChangeTires/
‚îú‚îÄ‚îÄ üìÅ Domain/                   # Regras de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ Entities/               # TireChangeArticle
‚îÇ   ‚îú‚îÄ‚îÄ ValueObjects/           # VehicleData, TireChangeContent
‚îÇ   ‚îú‚îÄ‚îÄ Services/               # Regras de dom√≠nio
‚îÇ   ‚îî‚îÄ‚îÄ Repositories/           # Interfaces
‚îú‚îÄ‚îÄ üìÅ Infrastructure/          # Implementa√ß√µes t√©cnicas
‚îÇ   ‚îú‚îÄ‚îÄ Console/Commands/       # Artisan commands
‚îÇ   ‚îú‚îÄ‚îÄ Services/               # Processamento e storage
‚îÇ   ‚îú‚îÄ‚îÄ Repositories/           # Implementa√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ Providers/              # Inje√ß√£o de depend√™ncia
‚îî‚îÄ‚îÄ üìÅ Application/             # Casos de uso
    ‚îú‚îÄ‚îÄ UseCases/               # L√≥gica de aplica√ß√£o
    ‚îú‚îÄ‚îÄ DTOs/                   # Transfer objects
    ‚îî‚îÄ‚îÄ Services/               # Orquestra√ß√£o
```

### Componentes Principais

| Componente                      | Responsabilidade                |
| ------------------------------- | ------------------------------- |
| **TireChangeArticle**           | Model principal para artigos    |
| **VehicleDataProcessorService** | Importa√ß√£o e processamento CSV  |
| **TemplateBasedContentService** | Gera√ß√£o de conte√∫do estruturado |
| **TireChangeArticleRepository** | Persist√™ncia com cache          |
| **ArticleJsonStorageService**   | Gerenciamento de JSONs          |

---

## üöÄ Instala√ß√£o

### 1. Pr√©-requisitos

```bash
# Verificar vers√µes
php --version    # >= 8.1
composer --version
```

### 2. Instalar M√≥dulo

```bash
# Executar instala√ß√£o completa
php artisan when-to-change-tires:install

# Ou instalar for√ßando sobrescrita
php artisan when-to-change-tires:install --force
```

### 3. Preparar Dados

```bash
# Colocar arquivo CSV na pasta correta
cp todos_veiculos.csv storage/app/

# Verificar estrutura do CSV
head -5 storage/app/todos_veiculos.csv
```

### 4. Executar Migrations

```bash
# Se n√£o executou durante instala√ß√£o
php artisan migrate
```

### 5. Verificar Instala√ß√£o

```bash
# Testar importa√ß√£o
php artisan when-to-change-tires:import-vehicles --show-stats

# Verificar estrutura
php artisan list when-to-change-tires
```

---

## ‚öôÔ∏è Configura√ß√£o

### Arquivo .env

```env
# M√≥dulo Quando Trocar Pneus
WHEN_TO_CHANGE_TIRES_ENABLED=true

# Configura√ß√µes de Gera√ß√£o
TIRE_ARTICLES_BATCH_SIZE=50
TIRE_ARTICLES_MAX_RETRIES=3
TIRE_ARTICLES_TIMEOUT=300
TIRE_ARTICLES_MEMORY_LIMIT=512M

# Qualidade
TIRE_ARTICLES_MIN_WORDS=800
TIRE_ARTICLES_MIN_SCORE=6.0

# Armazenamento
TIRE_ARTICLES_JSON_PATH=articles/when-to-change-tires
TIRE_ARTICLES_BACKUP_ENABLED=true

# CSV
TIRE_ARTICLES_CSV_PATH=todos_veiculos.csv
TIRE_ARTICLES_CSV_ENCODING=UTF-8

# Cache
TIRE_ARTICLES_CACHE_ENABLED=true
TIRE_ARTICLES_CACHE_STATS_TTL=1800

# Logs
TIRE_ARTICLES_LOGGING_ENABLED=true
TIRE_ARTICLES_LOG_LEVEL=info

# Scheduled Tasks
TIRE_ARTICLES_AUTO_GENERATION=false
TIRE_ARTICLES_AUTO_CLEANUP=true

# SEO
TIRE_ARTICLES_BASE_URL=https://mercadoveiculos.com
TIRE_ARTICLES_URL_PREFIX=info/quando-trocar-pneus

# Claude API (Etapa 2 - Futuro)
TIRE_ARTICLES_CLAUDE_ENABLED=false
CLAUDE_API_KEY=your_claude_api_key_here
```

### Arquivo de Configura√ß√£o

```php
// config/when-to-change-tires.php
return [
    'enabled' => env('WHEN_TO_CHANGE_TIRES_ENABLED', true),
    'generation' => [
        'batch_size' => env('TIRE_ARTICLES_BATCH_SIZE', 50),
        'timeout' => env('TIRE_ARTICLES_TIMEOUT', 300),
    ],
    // ... outras configura√ß√µes
];
```

---

## üñ•Ô∏è Comandos Dispon√≠veis

### üì• Importa√ß√£o e Valida√ß√£o

```bash
# Importar ve√≠culos do CSV com estat√≠sticas
php artisan when-to-change-tires:import-vehicles --show-stats

# Importar apenas Honda
php artisan when-to-change-tires:import-vehicles --filter-make=Honda

# Importar apenas motocicletas
php artisan when-to-change-tires:import-vehicles --filter-vehicle-type=motorcycle

# Validar dados sem processar
php artisan when-to-change-tires:import-vehicles --validate-only

# Filtrar por anos
php artisan when-to-change-tires:import-vehicles --year-from=2020 --year-to=2024
```

### üîÑ Gera√ß√£o de Artigos

```bash
# Gerar todos os artigos
php artisan when-to-change-tires:generate-initial-articles

# Gerar com filtros espec√≠ficos
php artisan when-to-change-tires:generate-initial-articles --filter-make=Honda
php artisan when-to-change-tires:generate-initial-articles --filter-category=hatch
php artisan when-to-change-tires:generate-initial-articles --filter-vehicle-type=motorcycle

# Controles de execu√ß√£o
php artisan when-to-change-tires:generate-initial-articles --batch-size=20
php artisan when-to-change-tires:generate-initial-articles --dry-run
php artisan when-to-change-tires:generate-initial-articles --show-progress
php artisan when-to-change-tires:generate-initial-articles --only-json
php artisan when-to-change-tires:generate-initial-articles --overwrite

# Filtros por ano
php artisan when-to-change-tires:generate-initial-articles --year-from=2020 --year-to=2024
```

### üì¶ Processamento de Lotes

```bash
# Processar lote espec√≠fico
php artisan when-to-change-tires:process-batch batch_20250628_001

# For√ßar processamento
php artisan when-to-change-tires:process-batch batch_20250628_001 --force

# Apenas JSONs
php artisan when-to-change-tires:process-batch batch_20250628_001 --only-json
```

### üõ†Ô∏è Instala√ß√£o e Manuten√ß√£o

```bash
# Instala√ß√£o completa
php artisan when-to-change-tires:install

# Reinstalar for√ßando
php artisan when-to-change-tires:install --force
```

---

## üìä Estrutura de Dados

### CSV de Entrada (todos_veiculos.csv)

```csv
make,model,year,tire_size,pressure_empty_front,pressure_empty_rear,pressure_light_front,pressure_light_rear,pressure_max_front,pressure_max_rear,pressure_spare,category,recommended_oil
Honda,Civic,2022,215/55 R17,32,32,34,34,36,36,35,sedan,0W20 Sint√©tico
Honda,Bros 160,2022,90/90-19 (dianteiro) 110/90-17 (traseiro),29,33,31,35,35,37,35,motorcycle_trail,10W30 Semissint√©tico
```

### Model TireChangeArticle

```php
// Campos principais
'make', 'model', 'year'              // Identifica√ß√£o do ve√≠culo
'tire_size'                          // Medida dos pneus
'pressure_empty_front/rear'          // Press√µes ve√≠culo vazio
'pressure_light_front/rear'          // Press√µes com carga
'pressure_max_front/rear'            // Press√µes m√°ximas
'category'                           // Categoria (hatch, sedan, motorcycle_*)
'recommended_oil'                    // √ìleo recomendado

// Conte√∫do e metadados
'title', 'slug'                      // SEO
'article_content'                    // JSON estruturado
'meta_description', 'seo_keywords'   // SEO
'wordpress_url', 'canonical_url'     // URLs

// Controle de qualidade
'generation_status'                  // pending, generated, claude_enhanced
'content_score'                      // 1-10 (autom√°tico)
'quality_checked'                    // boolean
'batch_id'                          // Identifica√ß√£o do lote
```

### JSON de Sa√≠da

```json
{
    "title": "Quando Trocar os Pneus do Honda Civic 2022 - Guia Completo",
    "slug": "quando-trocar-pneus-honda-civic-2022",
    "template": "when_to_change_tires",
    "content": {
        "introducao": "Identificar o momento certo para trocar...",
        "sintomas_desgaste": {
            "vibracao_direcao": {
                "titulo": "Vibra√ß√£o na Dire√ß√£o",
                "severidade": "alta"
            }
        },
        "fatores_durabilidade": {
            "calibragem_inadequada": {
                "impacto_negativo": "-30%"
            }
        },
        "cronograma_verificacao": {
            "quinzenal": {
                "titulo": "Verifica√ß√£o Quinzenal"
            }
        },
        "tipos_pneus": {
            "original_oem": {
                "quilometragem_esperada": "50.000 - 60.000 km"
            }
        },
        "vehicle_data": {
            "pressure_display": "32/32 PSI",
            "tire_size": "215/55 R17"
        }
    },
    "seo_data": {
        "page_title": "Quando Trocar os Pneus do Honda Civic 2022",
        "meta_description": "Guia completo sobre quando trocar...",
        "h2_tags": ["Sintomas de Pneus", "Fatores de Durabilidade"]
    },
    "vehicle_info": {
        "make": "Honda",
        "model": "Civic",
        "year": "2022"
    }
}
```

---

## üîÑ Fluxo de Funcionamento

### Etapa 1: Gera√ß√£o Inicial

```mermaid
graph TD
    A[CSV todos_veiculos.csv] --> B[VehicleDataProcessorService]
    B --> C[Filtros e Valida√ß√£o]
    C --> D[Cria√ß√£o de Lotes]
    D --> E[TemplateBasedContentService]
    E --> F[Gera√ß√£o de JSON]
    F --> G[TireChangeArticle Model]
    G --> H[ArticleJsonStorageService]
    H --> I[Artigos Prontos]
```

### Processo Detalhado

1. **Importa√ß√£o**: CSV ‚Üí VehicleData objects
2. **Filtros**: Aplicar crit√©rios (marca, categoria, ano)
3. **Valida√ß√£o**: Verificar dados obrigat√≥rios
4. **Lotes**: Dividir em grupos process√°veis
5. **Gera√ß√£o**: Criar conte√∫do estruturado
6. **Persist√™ncia**: Salvar JSON + Model
7. **Quality Score**: Calcular pontua√ß√£o autom√°tica

### Status de Artigos

| Status               | Descri√ß√£o                  |
| -------------------- | -------------------------- |
| `pending`            | Aguardando processamento   |
| `generated`          | Artigo inicial criado      |
| `claude_enhanced`    | Refinado pela IA (Etapa 2) |
| `ready_for_transfer` | Pronto para WordPress      |
| `transferred`        | Enviado para sistema final |
| `published`          | Publicado no site          |
| `error`              | Erro durante processamento |

---

## üìù Exemplos de Uso

### Cen√°rio 1: Gerar Artigos para Honda

```bash
# 1. Verificar quantos ve√≠culos Honda existem
php artisan when-to-change-tires:import-vehicles --filter-make=Honda --show-stats

# 2. Gerar apenas artigos Honda em lotes pequenos
php artisan when-to-change-tires:generate-initial-articles \
  --filter-make=Honda \
  --batch-size=10 \
  --show-progress

# 3. Verificar resultados
ls storage/app/articles/when-to-change-tires/ | grep honda | wc -l
```

### Cen√°rio 2: Testar com Motocicletas

```bash
# 1. Simular gera√ß√£o de motocicletas
php artisan when-to-change-tires:generate-initial-articles \
  --filter-vehicle-type=motorcycle \
  --batch-size=5 \
  --dry-run

# 2. Gerar realmente se simula√ß√£o OK
php artisan when-to-change-tires:generate-initial-articles \
  --filter-vehicle-type=motorcycle \
  --batch-size=5
```

### Cen√°rio 3: Gera√ß√£o Completa

```bash
# 1. Validar todos os dados primeiro
php artisan when-to-change-tires:import-vehicles --validate-only --show-stats

# 2. Gerar todos os artigos em lotes maiores
php artisan when-to-change-tires:generate-initial-articles \
  --batch-size=50 \
  --show-progress

# 3. Verificar estat√≠sticas finais
mysql -e "SELECT generation_status, COUNT(*) FROM tire_change_articles GROUP BY generation_status;"
```

### Cen√°rio 4: Desenvolvimento e Debug

```bash
# 1. Gerar apenas 1 artigo para testar
php artisan when-to-change-tires:generate-initial-articles \
  --filter-make=Honda \
  --batch-size=1 \
  --verbose

# 2. Verificar logs detalhados
tail -f storage/logs/laravel.log | grep "tire"

# 3. Inspecionar JSON gerado
cat storage/app/articles/when-to-change-tires/quando-trocar-pneus-honda-civic-2022.json | jq .
```

---

## üõ†Ô∏è Solu√ß√£o de Problemas

### Problemas Comuns

#### ‚ùå Erro: "CSV n√£o encontrado"

```bash
# Verificar localiza√ß√£o
ls -la storage/app/todos_veiculos.csv

# Copiar se necess√°rio
cp /path/to/todos_veiculos.csv storage/app/
```

#### ‚ùå Erro: "Memory limit exceeded"

```bash
# Aumentar mem√≥ria no .env
TIRE_ARTICLES_MEMORY_LIMIT=1024M

# Ou reduzir batch size
php artisan when-to-change-tires:generate-initial-articles --batch-size=10
```

#### ‚ùå Erro: "Class not found"

```bash
# Limpar cache
php artisan cache:clear
php artisan config:clear
composer dump-autoload
```

#### ‚ùå Erro: "M√©todos duplicados"

```bash
# Usar vers√£o corrigida do TemplateBasedContentService
# Substituir pelo arquivo corrigido fornecido
```

### Debug e Logs

```bash
# Ativar logs detalhados
export TIRE_ARTICLES_LOG_LEVEL=debug

# Verificar logs em tempo real
tail -f storage/logs/laravel.log

# Verificar tabela de artigos
mysql -e "SELECT COUNT(*), generation_status FROM tire_change_articles GROUP BY generation_status;"

# Verificar arquivos JSON
find storage/app/articles/when-to-change-tires/ -name "*.json" | wc -l
```

### Performance

```bash
# Verificar uso de mem√≥ria
php artisan when-to-change-tires:generate-initial-articles --dry-run | grep -i memory

# Otimizar batch size
php artisan when-to-change-tires:generate-initial-articles --batch-size=25

# Ativar cache
export TIRE_ARTICLES_CACHE_ENABLED=true
```

---

## üöÄ Desenvolvimento

### Estrutura para Novos Features

```php
// 1. Criar novo ValueObject
namespace Domain\ValueObjects;
class NewFeatureData { ... }

// 2. Adicionar m√©todo no Service
class TemplateBasedContentService {
    protected function generateNewFeature(VehicleData $vehicle): array {
        // Implementa√ß√£o
    }
}

// 3. Atualizar estrutura JSON
protected function generateContentStructure(VehicleData $vehicle): array {
    return [
        'introducao' => $this->generateIntroduction($vehicle),
        'new_feature' => $this->generateNewFeature($vehicle), // Nova se√ß√£o
        // ... outras se√ß√µes
    ];
}
```

### Adicionando Novos Filtros

```php
// VehicleDataProcessorService
public function filterVehicles(Collection $vehicles, array $criteria): Collection {
    return $vehicles->filter(function (VehicleData $vehicle) use ($criteria) {
        // Adicionar novo filtro
        if (!empty($criteria['new_filter'])) {
            if ($vehicle->someProperty !== $criteria['new_filter']) {
                return false;
            }
        }
        // ... outros filtros
    });
}
```

### Testes

```bash
# Executar testes do m√≥dulo
php artisan test --filter="WhenToChangeTires"

# Teste espec√≠fico
php artisan test tests/Unit/WhenToChangeTires/VehicleDataProcessorServiceTest.php
```

### Contribuindo

1. **Fork** do reposit√≥rio
2. **Criar branch** para feature: `git checkout -b feature/nova-funcionalidade`
3. **Fazer commit**: `git commit -am 'Adiciona nova funcionalidade'`
4. **Push** para branch: `git push origin feature/nova-funcionalidade`
5. **Criar Pull Request**

---

## üìà M√©tricas e Monitoramento

### Estat√≠sticas do Sistema

```bash
# Dashboard completo
php artisan tinker
>>> app(\Src\ContentGeneration\WhenToChangeTires\Infrastructure\Services\TireChangeArticleService::class)->getDashboardStats()

# Estat√≠sticas espec√≠ficas
>>> app(\Src\ContentGeneration\WhenToChangeTires\Infrastructure\Repositories\TireChangeArticleRepository::class)->getStatistics()
```

### Dados Esperados

| M√©trica                | Valor Esperado |
| ---------------------- | -------------- |
| **Total de Ve√≠culos**  | 965            |
| **Carros**             | 391            |
| **Motocicletas**       | 410            |
| **El√©tricos/H√≠bridos** | 164            |
| **Marcas**             | 25+            |
| **Anos**               | 2019-2025      |

### Qualidade dos Artigos

| Score    | Descri√ß√£o                                      |
| -------- | ---------------------------------------------- |
| 9.0-10.0 | Excelente (>2000 palavras, estrutura completa) |
| 8.0-8.9  | Muito Bom (1500-2000 palavras)                 |
| 7.0-7.9  | Bom (1000-1500 palavras)                       |
| 6.0-6.9  | Adequado (800-1000 palavras)                   |
| <6.0     | Precisa melhorar                               |

---

## üîÆ Roadmap (Etapa 2)

### Claude API Integration

-   ‚úÖ **Infraestrutura preparada** (campos na model, configura√ß√µes)
-   üîÑ **Em desenvolvimento**: Services de refinamento
-   üìã **Planejado**: Commands de enhancement
-   üéØ **Futuro**: Automa√ß√£o completa

### Features Futuras

-   üìä **Dashboard Web** para monitoramento
-   üîÑ **API REST** para integra√ß√£o externa
-   üì± **Notifica√ß√µes** por email/Slack
-   üîç **Busca avan√ßada** de artigos
-   üìà **Analytics** de performance

---

## üìû Suporte

### Documenta√ß√£o

-   **README**: Este arquivo
-   **Config**: `config/when-to-change-tires.php`
-   **Commands**: `php artisan list when-to-change-tires`

### Logs

```bash
# Logs do sistema
tail -f storage/logs/laravel.log | grep "WhenToChangeTires"

# Logs espec√≠ficos (se configurado)
tail -f storage/logs/tire-articles.log
```

### Contato

-   **Issues**: Criar issue no reposit√≥rio
-   **Features**: Pull request com documenta√ß√£o
-   **D√∫vidas**: Verificar logs e documenta√ß√£o primeiro

---

## üìú Licen√ßa

Este projeto est√° licenciado sob a [MIT License](LICENSE).

---

## üôè Agradecimentos

-   **Laravel Framework** pela base s√≥lida
-   **DDD Architecture** pelos padr√µes de organiza√ß√£o
-   **Claude AI** pela futura integra√ß√£o de refinamento

---

**üéâ Sistema pronto para uso! Boa gera√ß√£o de artigos!** üöÄ
