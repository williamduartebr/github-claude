# ğŸ“‹ **DOCUMENTO DE ESPECIFICAÃ‡ÃƒO - SEGUNDA ETAPA DO TIREPRESSUREGUIDE**

## **ğŸ¯ CONTEXTO PARA O PRÃ“XIMO CHAT COM CLAUDE**

### **ğŸ“Š Estado Atual do Projeto:**
- âœ… **Primeira Etapa CONCLUÃDA** com 99.8% de sucesso
- âœ… **1926 artigos gerados** (965 veÃ­culos Ã— 2 templates)
- âœ… **Template "ideal":** 963 artigos
- âœ… **Template "calibration":** 963 artigos
- ğŸ”„ **PRÃ“XIMO:** Segunda Etapa - Refinamento Claude das SeÃ§Ãµes

---

## **ğŸš€ SEGUNDA ETAPA - REFINAMENTO CLAUDE DAS SEÃ‡Ã•ES**

### **ğŸ“‹ O que Claude precisa entender:**

**1. ESTRUTURA ATUAL DOS ARTIGOS:**
Cada `TirePressureArticle` tem **6 seÃ§Ãµes separadas** prontas para refinamento:
- `sections_intro` - IntroduÃ§Ã£o personalizada
- `sections_pressure_table` - Tabela de pressÃµes otimizada  
- `sections_how_to_calibrate` - Passos especÃ­ficos do veÃ­culo
- `sections_middle_content` - Dicas, warnings, maintenance_checklist
- `sections_faq` - FAQ personalizada para o veÃ­culo
- `sections_conclusion` - ConclusÃ£o call-to-action

**2. WORKFLOW DE REFINAMENTO:**
```php
// Para cada seÃ§Ã£o:
1. markSectionAsProcessing($sectionName)
2. getSectionForRefinement($sectionName) 
3. callClaudeAPI($sectionData)
4. refineSection($sectionName, $refinedContent)
5. markSectionAsRefined($sectionName)
```

**3. ARQUITETURA DE SERVICES EXISTENTE:**
Com base nos arquivos analisados, jÃ¡ existe uma estrutura robusta:
- `ClaudeApiService` - ComunicaÃ§Ã£o com Claude API âœ…
- `TireDataValidationService` - ValidaÃ§Ã£o de dados âœ…
- `TireCorrectionOrchestrator` - OrquestraÃ§Ã£o de processamento âœ…
- Rate limiting inteligente implementado âœ…

---

## **âš™ï¸ CONFIGURAÃ‡Ã•ES CLAUDE API PARA SEGUNDA ETAPA**

### **ğŸ¤– ConfiguraÃ§Ãµes Recomendadas:**

```php
// Para Refinamento de SeÃ§Ãµes (ALTA QUALIDADE)
'model' => 'claude-3-5-sonnet-20240620',  // Modelo premium para melhor qualidade
'max_tokens' => 4000,                      // Suficiente para seÃ§Ãµes detalhadas
'temperature' => 0.3,                      // Criatividade controlada + consistÃªncia
```

### **ğŸ“Š ConfiguraÃ§Ãµes por Tipo de SeÃ§Ã£o:**

| SeÃ§Ã£o | Model | Max Tokens | Temperature | Justificativa |
|-------|-------|------------|-------------|---------------|
| **intro** | claude-3-5-sonnet | 2500 | 0.3 | Precisa ser envolvente e especÃ­fica |
| **pressure_table** | claude-3-5-sonnet | 2000 | 0.2 | Dados tÃ©cnicos precisos |
| **how_to_calibrate** | claude-3-5-sonnet | 3000 | 0.3 | InstruÃ§Ãµes claras e especÃ­ficas |
| **middle_content** | claude-3-5-sonnet | 3500 | 0.4 | Dicas criativas e warnings |
| **faq** | claude-3-5-sonnet | 4000 | 0.3 | Perguntas variadas e especÃ­ficas |
| **conclusion** | claude-3-5-sonnet | 2000 | 0.4 | Call-to-action motivacional |

---

## **ğŸ”§ ARQUIVOS QUE PRECISAM SER CRIADOS**

### **1. Use Cases:**
```
Src/ContentGeneration/TirePressureGuide/Application/UseCases/
â”œâ”€â”€ RefineArticleSectionsUseCase.php          // OrquestraÃ§Ã£o principal
â””â”€â”€ ProcessSectionRefinementUseCase.php       // Refinamento individual
```

### **2. Services:**
```
Src/ContentGeneration/TirePressureGuide/Application/Services/
â”œâ”€â”€ ClaudeRefinementService.php               // IntegraÃ§Ã£o Claude
â””â”€â”€ SectionValidationService.php              // ValidaÃ§Ã£o de qualidade
```

### **3. Commands:**
```
Src/ContentGeneration/TirePressureGuide/Infrastructure/Console/Commands/
â”œâ”€â”€ RefineArticleSectionsCommand.php          // Comando principal
â”œâ”€â”€ ProcessSectionQueueCommand.php            // Processamento em fila
â””â”€â”€ ValidateSectionQualityCommand.php         // ValidaÃ§Ã£o pÃ³s-refinamento
```

### **4. Infrastructure Services:**
```
Src/ContentGeneration/TirePressureGuide/Infrastructure/Services/
â”œâ”€â”€ SectionRefinementService.php              // Service especÃ­fico de seÃ§Ãµes
â””â”€â”€ QualityAssuranceService.php               // Controle de qualidade
```

---

## **ğŸ“ PROMPTS ESPECÃFICOS POR SEÃ‡ÃƒO**

### **ğŸ¯ Template de Prompt por SeÃ§Ã£o:**

**INTRO (SeÃ§Ã£o de IntroduÃ§Ã£o):**
```
Sistema: "VocÃª Ã© um especialista automotivo brasileiro criando introduÃ§Ãµes envolventes sobre pressÃ£o de pneus. Conecte emocionalmente com o proprietÃ¡rio do {VEHICLE_NAME}, enfatize seguranÃ§a, economia e durabilidade."

Prompt: "Reescreva a introduÃ§Ã£o para um guia sobre pressÃ£o ideal/calibragem de pneus do {VEHICLE_FULL_NAME}..."
```

**PRESSURE_TABLE (Tabela de PressÃµes):**
```
Sistema: "VocÃª Ã© um especialista tÃ©cnico criando tabelas precisas de pressÃ£o de pneus. Dados devem ser tecnicamente corretos e bem formatados."

Prompt: "Crie uma tabela otimizada de pressÃµes para o {VEHICLE_FULL_NAME} com diferentes condiÃ§Ãµes de carga..."
```

**Continuar para todas as 6 seÃ§Ãµes...**

---

## **ğŸ¯ COMANDOS ANTECIPADOS PARA IMPLEMENTAR**

### **Commands que serÃ£o criados:**

```bash
# Refinar seÃ§Ãµes especÃ­ficas de artigos
php artisan tire-pressure-guide:refine-sections 
    --section=all                # SeÃ§Ã£o especÃ­fica (intro,pressure_table,etc)
    --template=ideal             # Template especÃ­fico
    --limit=50                   # NÃºmero de artigos
    --batch-size=10              # Artigos processados em paralelo
    --dry-run                    # Preview sem aplicar

# Processar fila de refinamento Claude
php artisan tire-pressure-guide:process-section-queue
    --workers=3                  # Workers paralelos
    --timeout=300                # Timeout por seÃ§Ã£o
    --priority=high              # Prioridade

# Validar qualidade pÃ³s-refinamento  
php artisan tire-pressure-guide:validate-section-quality
    --section=faq                # SeÃ§Ã£o especÃ­fica
    --min-score=8.0              # Score mÃ­nimo
    --fix-low-quality            # Corrigir automaticamente
```

---

## **ğŸ“Š SISTEMA DE CONTROLE DE QUALIDADE**

### **ğŸ¯ MÃ©tricas de Qualidade por SeÃ§Ã£o:**

```php
'sections_scores' => [
    'intro' => 8.2,              // Score de qualidade (1-10)
    'pressure_table' => 9.1,     // PrecisÃ£o tÃ©cnica
    'how_to_calibrate' => 7.8,   // Clareza das instruÃ§Ãµes
    'middle_content' => 8.5,     // RelevÃ¢ncia das dicas
    'faq' => 8.0,                // Qualidade das perguntas
    'conclusion' => 7.9          // Impacto do call-to-action
]
```

### **ğŸ” ValidaÃ§Ãµes AutomÃ¡ticas:**
- âœ… ConteÃºdo especÃ­fico do veÃ­culo presente
- âœ… Sem placeholders genÃ©ricos
- âœ… PressÃµes tecnicamente corretas
- âœ… Linguagem natural e envolvente
- âœ… Call-to-actions efetivos

---

## **âš¡ PERFORMANCE E RATE LIMITING**

### **ğŸ¯ EstratÃ©gia de Rate Limiting:**

```php
// Claude API - ConfiguraÃ§Ã£o otimizada
$rateLimitConfig = [
    'requests_per_minute' => 60,        // 1 request por segundo
    'requests_per_hour' => 3000,       // Limite horÃ¡rio
    'backoff_strategy' => 'exponential', // 30s, 60s, 120s, 300s
    'max_retries' => 3,                // MÃ¡ximo de tentativas
    'timeout_per_request' => 45        // 45 segundos por request
];
```

### **ğŸ“ˆ Estimativas de Processamento:**

| MÃ©trica | Valor |
|---------|-------|
| **Total de seÃ§Ãµes** | 11,556 (1926 artigos Ã— 6 seÃ§Ãµes) |
| **Tempo por seÃ§Ã£o** | ~45 segundos (Claude API) |
| **Processamento paralelo** | 3 workers simultÃ¢neos |
| **Tempo total estimado** | ~48 horas (com rate limiting) |
| **Taxa de sucesso esperada** | 95%+ |

---

## **ğŸš€ PRÃ“XIMOS PASSOS PARA IMPLEMENTAÃ‡ÃƒO**

### **ğŸ“‹ Checklist para o PrÃ³ximo Chat:**

1. âœ… **Use a estrutura de services existente** (ClaudeApiService, etc.)
2. âœ… **Implemente os 6 tipos de refinamento** por seÃ§Ã£o
3. âœ… **Configure rate limiting inteligente** (60 req/min)
4. âœ… **Crie sistema de filas** para processamento paralelo
5. âœ… **Implemente validaÃ§Ã£o de qualidade** automÃ¡tica
6. âœ… **Adicione recovery automÃ¡tico** para falhas
7. âœ… **Configure logs detalhados** para monitoramento

### **ğŸ¯ Resultado Final Esperado:**

ApÃ³s a Segunda Etapa:
- **1926 artigos** com **6 seÃ§Ãµes refinadas** cada
- **Qualidade premium** via Claude 3.5 Sonnet
- **ConteÃºdo especÃ­fico** para cada veÃ­culo
- **Rate de sucesso 95%+**
- **Prontos para publicaÃ§Ã£o** no WordPress

---

## **ğŸ’¡ CONTEXTO IMPORTANTE PARA CLAUDE**

**"Temos 1926 artigos de pressÃ£o de pneus jÃ¡ gerados (Primeira Etapa completa com 99.8% sucesso). Cada artigo tem 6 seÃ§Ãµes bÃ¡sicas que precisam ser refinadas com Claude 3.5 Sonnet. JÃ¡ existe infraestrutura robusta de Claude API com rate limiting. Preciso implementar a Segunda Etapa: refinamento inteligente das seÃ§Ãµes usando a arquitetura de micro-services existente, com processamento paralelo, validaÃ§Ã£o de qualidade e recovery automÃ¡tico."**

**Esta Ã© toda a informaÃ§Ã£o que Claude precisa para implementar a Segunda Etapa com excelÃªncia!** ğŸš€