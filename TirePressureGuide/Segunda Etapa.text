# 📋 **DOCUMENTO DE ESPECIFICAÇÃO - SEGUNDA ETAPA DO TIREPRESSUREGUIDE**

## **🎯 CONTEXTO PARA O PRÓXIMO CHAT COM CLAUDE**

### **📊 Estado Atual do Projeto:**
- ✅ **Primeira Etapa CONCLUÍDA** com 99.8% de sucesso
- ✅ **1926 artigos gerados** (965 veículos × 2 templates)
- ✅ **Template "ideal":** 963 artigos
- ✅ **Template "calibration":** 963 artigos
- 🔄 **PRÓXIMO:** Segunda Etapa - Refinamento Claude das Seções

---

## **🚀 SEGUNDA ETAPA - REFINAMENTO CLAUDE DAS SEÇÕES**

### **📋 O que Claude precisa entender:**

**1. ESTRUTURA ATUAL DOS ARTIGOS:**
Cada `TirePressureArticle` tem **6 seções separadas** prontas para refinamento:
- `sections_intro` - Introdução personalizada
- `sections_pressure_table` - Tabela de pressões otimizada  
- `sections_how_to_calibrate` - Passos específicos do veículo
- `sections_middle_content` - Dicas, warnings, maintenance_checklist
- `sections_faq` - FAQ personalizada para o veículo
- `sections_conclusion` - Conclusão call-to-action

**2. WORKFLOW DE REFINAMENTO:**
```php
// Para cada seção:
1. markSectionAsProcessing($sectionName)
2. getSectionForRefinement($sectionName) 
3. callClaudeAPI($sectionData)
4. refineSection($sectionName, $refinedContent)
5. markSectionAsRefined($sectionName)
```

**3. ARQUITETURA DE SERVICES EXISTENTE:**
Com base nos arquivos analisados, já existe uma estrutura robusta:
- `ClaudeApiService` - Comunicação com Claude API ✅
- `TireDataValidationService` - Validação de dados ✅
- `TireCorrectionOrchestrator` - Orquestração de processamento ✅
- Rate limiting inteligente implementado ✅

---

## **⚙️ CONFIGURAÇÕES CLAUDE API PARA SEGUNDA ETAPA**

### **🤖 Configurações Recomendadas:**

```php
// Para Refinamento de Seções (ALTA QUALIDADE)
'model' => 'claude-3-5-sonnet-20240620',  // Modelo premium para melhor qualidade
'max_tokens' => 4000,                      // Suficiente para seções detalhadas
'temperature' => 0.3,                      // Criatividade controlada + consistência
```

### **📊 Configurações por Tipo de Seção:**

| Seção | Model | Max Tokens | Temperature | Justificativa |
|-------|-------|------------|-------------|---------------|
| **intro** | claude-3-5-sonnet | 2500 | 0.3 | Precisa ser envolvente e específica |
| **pressure_table** | claude-3-5-sonnet | 2000 | 0.2 | Dados técnicos precisos |
| **how_to_calibrate** | claude-3-5-sonnet | 3000 | 0.3 | Instruções claras e específicas |
| **middle_content** | claude-3-5-sonnet | 3500 | 0.4 | Dicas criativas e warnings |
| **faq** | claude-3-5-sonnet | 4000 | 0.3 | Perguntas variadas e específicas |
| **conclusion** | claude-3-5-sonnet | 2000 | 0.4 | Call-to-action motivacional |

---

## **🔧 ARQUIVOS QUE PRECISAM SER CRIADOS**

### **1. Use Cases:**
```
Src/ContentGeneration/TirePressureGuide/Application/UseCases/
├── RefineArticleSectionsUseCase.php          // Orquestração principal
└── ProcessSectionRefinementUseCase.php       // Refinamento individual
```

### **2. Services:**
```
Src/ContentGeneration/TirePressureGuide/Application/Services/
├── ClaudeRefinementService.php               // Integração Claude
└── SectionValidationService.php              // Validação de qualidade
```

### **3. Commands:**
```
Src/ContentGeneration/TirePressureGuide/Infrastructure/Console/Commands/
├── RefineArticleSectionsCommand.php          // Comando principal
├── ProcessSectionQueueCommand.php            // Processamento em fila
└── ValidateSectionQualityCommand.php         // Validação pós-refinamento
```

### **4. Infrastructure Services:**
```
Src/ContentGeneration/TirePressureGuide/Infrastructure/Services/
├── SectionRefinementService.php              // Service específico de seções
└── QualityAssuranceService.php               // Controle de qualidade
```

---

## **📝 PROMPTS ESPECÍFICOS POR SEÇÃO**

### **🎯 Template de Prompt por Seção:**

**INTRO (Seção de Introdução):**
```
Sistema: "Você é um especialista automotivo brasileiro criando introduções envolventes sobre pressão de pneus. Conecte emocionalmente com o proprietário do {VEHICLE_NAME}, enfatize segurança, economia e durabilidade."

Prompt: "Reescreva a introdução para um guia sobre pressão ideal/calibragem de pneus do {VEHICLE_FULL_NAME}..."
```

**PRESSURE_TABLE (Tabela de Pressões):**
```
Sistema: "Você é um especialista técnico criando tabelas precisas de pressão de pneus. Dados devem ser tecnicamente corretos e bem formatados."

Prompt: "Crie uma tabela otimizada de pressões para o {VEHICLE_FULL_NAME} com diferentes condições de carga..."
```

**Continuar para todas as 6 seções...**

---

## **🎯 COMANDOS ANTECIPADOS PARA IMPLEMENTAR**

### **Commands que serão criados:**

```bash
# Refinar seções específicas de artigos
php artisan tire-pressure-guide:refine-sections 
    --section=all                # Seção específica (intro,pressure_table,etc)
    --template=ideal             # Template específico
    --limit=50                   # Número de artigos
    --batch-size=10              # Artigos processados em paralelo
    --dry-run                    # Preview sem aplicar

# Processar fila de refinamento Claude
php artisan tire-pressure-guide:process-section-queue
    --workers=3                  # Workers paralelos
    --timeout=300                # Timeout por seção
    --priority=high              # Prioridade

# Validar qualidade pós-refinamento  
php artisan tire-pressure-guide:validate-section-quality
    --section=faq                # Seção específica
    --min-score=8.0              # Score mínimo
    --fix-low-quality            # Corrigir automaticamente
```

---

## **📊 SISTEMA DE CONTROLE DE QUALIDADE**

### **🎯 Métricas de Qualidade por Seção:**

```php
'sections_scores' => [
    'intro' => 8.2,              // Score de qualidade (1-10)
    'pressure_table' => 9.1,     // Precisão técnica
    'how_to_calibrate' => 7.8,   // Clareza das instruções
    'middle_content' => 8.5,     // Relevância das dicas
    'faq' => 8.0,                // Qualidade das perguntas
    'conclusion' => 7.9          // Impacto do call-to-action
]
```

### **🔍 Validações Automáticas:**
- ✅ Conteúdo específico do veículo presente
- ✅ Sem placeholders genéricos
- ✅ Pressões tecnicamente corretas
- ✅ Linguagem natural e envolvente
- ✅ Call-to-actions efetivos

---

## **⚡ PERFORMANCE E RATE LIMITING**

### **🎯 Estratégia de Rate Limiting:**

```php
// Claude API - Configuração otimizada
$rateLimitConfig = [
    'requests_per_minute' => 60,        // 1 request por segundo
    'requests_per_hour' => 3000,       // Limite horário
    'backoff_strategy' => 'exponential', // 30s, 60s, 120s, 300s
    'max_retries' => 3,                // Máximo de tentativas
    'timeout_per_request' => 45        // 45 segundos por request
];
```

### **📈 Estimativas de Processamento:**

| Métrica | Valor |
|---------|-------|
| **Total de seções** | 11,556 (1926 artigos × 6 seções) |
| **Tempo por seção** | ~45 segundos (Claude API) |
| **Processamento paralelo** | 3 workers simultâneos |
| **Tempo total estimado** | ~48 horas (com rate limiting) |
| **Taxa de sucesso esperada** | 95%+ |

---

## **🚀 PRÓXIMOS PASSOS PARA IMPLEMENTAÇÃO**

### **📋 Checklist para o Próximo Chat:**

1. ✅ **Use a estrutura de services existente** (ClaudeApiService, etc.)
2. ✅ **Implemente os 6 tipos de refinamento** por seção
3. ✅ **Configure rate limiting inteligente** (60 req/min)
4. ✅ **Crie sistema de filas** para processamento paralelo
5. ✅ **Implemente validação de qualidade** automática
6. ✅ **Adicione recovery automático** para falhas
7. ✅ **Configure logs detalhados** para monitoramento

### **🎯 Resultado Final Esperado:**

Após a Segunda Etapa:
- **1926 artigos** com **6 seções refinadas** cada
- **Qualidade premium** via Claude 3.5 Sonnet
- **Conteúdo específico** para cada veículo
- **Rate de sucesso 95%+**
- **Prontos para publicação** no WordPress

---

## **💡 CONTEXTO IMPORTANTE PARA CLAUDE**

**"Temos 1926 artigos de pressão de pneus já gerados (Primeira Etapa completa com 99.8% sucesso). Cada artigo tem 6 seções básicas que precisam ser refinadas com Claude 3.5 Sonnet. Já existe infraestrutura robusta de Claude API com rate limiting. Preciso implementar a Segunda Etapa: refinamento inteligente das seções usando a arquitetura de micro-services existente, com processamento paralelo, validação de qualidade e recovery automático."**

**Esta é toda a informação que Claude precisa para implementar a Segunda Etapa com excelência!** 🚀