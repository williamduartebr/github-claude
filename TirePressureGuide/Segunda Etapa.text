# ğŸ“‹ **ESPECIFICAÃ‡ÃƒO COMPLETA - ETAPA 2 DO TIREPRESSUREGUIDE**

## **ğŸ¯ CONTEXTO ATUAL DO PROJETO**

### **ğŸ“Š Estado Atual:**
- âœ… **Primeira Etapa CONCLUÃDA** com 99.8% de sucesso
- âœ… **1926 artigos gerados** (965 veÃ­culos Ãºnicos Ã— 2 templates)
- âœ… **Template "ideal":** 963 artigos (pressÃ£o ideal dos pneus)
- âœ… **Template "calibration":** 963 artigos (como calibrar pneus)
- ğŸ”„ **PRÃ“XIMO:** Segunda Etapa dividida em 2 fases

### **ğŸ“‹ ESTRUTURA DOS ARTIGOS:**
Cada `TirePressureArticle` contÃ©m:
- `vehicle_data` - Dados tÃ©cnicos estruturados (**PRECISA CORREÃ‡ÃƒO PRIMEIRO**)
- `article_content` - ConteÃºdo base gerado (**MANTER INTACTO**)
- `sections_*` - 6 seÃ§Ãµes para refinamento (**NOSSA RESPONSABILIDADE**)

---

## **ğŸš€ ETAPA 2: DIVIDIDA EM 2 FASES SEQUENCIAIS**

### **ğŸ“‹ FASE 1: CORREÃ‡ÃƒO DO `vehicle_data` (PRIMEIRO)**

**OBJETIVO:** Padronizar `vehicle_data` IDÃŠNTICO para os 2 artigos de cada veÃ­culo

#### **ğŸ’¡ ESTRATÃ‰GIA OTIMIZADA:**
Como cada veÃ­culo gera 2 artigos (ideal + calibration) com **`vehicle_data` idÃªntico**, podemos:
- âœ… **Processar 1 veÃ­culo** = **corrigir 2 artigos** simultaneamente
- âœ… **965 execuÃ§Ãµes** = **1926 artigos** corrigidos
- âœ… **Economia de 50%** no tempo e chamadas API

#### **ğŸ” IDENTIFICAÃ‡ÃƒO POR VEÃCULO:**
```php
// Buscar AMBOS os artigos do mesmo veÃ­culo:
$articles = TirePressureArticle::where('vehicle_data.make', 'Fiat')
    ->where('vehicle_data.model', '500e') 
    ->where('vehicle_data.year', 2023)
    ->get();

// Resultado: 2 artigos com vehicle_data IDÃŠNTICO
// - slug: "pressao-pneus-fiat-500e-2023" (template: ideal)
// - slug: "como-calibrar-pneus-fiat-500e-2023" (template: calibration)
```

#### **âš¡ PROCESSAMENTO SIMULTÃ‚NEO:**
```php
// Corrigir vehicle_data UMA VEZ, aplicar nos DOIS artigos:
$correctedVehicleData = $this->claudeHaikuService->correctVehicleData($baseVehicleData);

foreach ($articles as $article) {
    $article->vehicle_data = $correctedVehicleData;
    $article->vehicle_data_corrected_at = now();
    $article->vehicle_data_version = 'v2.1';
    $article->save();
}
```

#### **ğŸ¤– ConfiguraÃ§Ã£o Claude para `vehicle_data`:**
```php
'model' => 'claude-3-haiku-20240307',  // PERFEITO para dados estruturados
'max_tokens' => 1500,                  // Suficiente para JSON
'temperature' => 0.1,                  // MÃ¡xima consistÃªncia
'timeout' => 30,                       // RÃ¡pido
'rate_limit' => 'every_180_seconds'    // 3 minutos (mais conservador)
```

#### **ğŸ’° Estimativas Fase 1 (OTIMIZADA):**
- **VeÃ­culos Ãºnicos:** 965 (nÃ£o 1926!)
- **Chamadas Claude:** 965 (economia de 50%)
- **Custo por veÃ­culo:** ~$0.003 USD
- **Total:** ~$3 USD (metade do estimado!)
- **Tempo:** 2 dias (965 Ã— 3 min = 48 horas)
- **Artigos corrigidos:** 1926 (2 por veÃ­culo)

#### **ğŸ”§ CorreÃ§Ãµes no `vehicle_data`:**
```php
// Campos a serem padronizados/corrigidos:
'vehicle_full_name' => 'Fiat 500e 2023',           // Gerado
'category_normalized' => 'Carros ElÃ©tricos',       // Normalizado
'pressure_display' => 'Dianteiros: 34 PSI / Traseiros: 32 PSI',
'empty_pressure_display' => '32/30 PSI',
'loaded_pressure_display' => '36/34 PSI',
'is_premium' => true,                               // Detectado
'has_tpms' => true,                                // Calculado
'vehicle_segment' => 'B',                          // Classificado
'vehicle_type' => 'car'                            // Padronizado
```

### **ğŸ“‹ FASE 2: REFINAMENTO DAS SEÃ‡Ã•ES (DEPOIS)**

**OBJETIVO:** Refinar 6 seÃ§Ãµes usando `vehicle_data` corrigido

#### **ğŸ¤– ConfiguraÃ§Ã£o Claude para SeÃ§Ãµes:**
```php
'model' => 'claude-3-5-sonnet-20240620',  // QUALIDADE PREMIUM
'max_tokens' => 4000,                      // Todas as 6 seÃ§Ãµes
'temperature' => 0.3,                      // Criatividade controlada
'timeout' => 45,                           // 45 segundos
'rate_limit' => 'every_60_seconds'         // 1 request/minuto
```

#### **ğŸ’° Estimativas Fase 2:**
- **Custo por artigo:** ~$0.04 USD
- **Total 1926 artigos:** ~$77 USD
- **Tempo:** 32 dias (schedule a cada 2 min)
- **Model:** Claude 3.5 Sonnet (qualidade premium para conteÃºdo)

---

## **ğŸ“ AS 6 SEÃ‡Ã•ES A SEREM REFINADAS**

### **ğŸ¯ SeÃ§Ãµes que Claude deve gerar:**

1. **`sections_intro`** - IntroduÃ§Ã£o envolvente e especÃ­fica
2. **`sections_pressure_table`** - Tabela tÃ©cnica otimizada  
3. **`sections_how_to_calibrate`** - InstruÃ§Ãµes passo-a-passo
4. **`sections_middle_content`** - Dicas, avisos, manutenÃ§Ã£o
5. **`sections_faq`** - FAQ personalizada para o veÃ­culo
6. **`sections_conclusion`** - ConclusÃ£o com call-to-action

### **ğŸ”„ DIFERENCIAÃ‡ÃƒO POR TEMPLATE:**

#### **Template "ideal" (PressÃ£o Ideal):**
- **Foco:** EspecificaÃ§Ãµes tÃ©cnicas, tabelas detalhadas, benefÃ­cios
- **Intro:** "PressÃ£o ideal do {vehicle_full_name}"
- **FAQ:** "Qual a pressÃ£o ideal?", "Por que essa pressÃ£o?"

#### **Template "calibration" (Como Calibrar):**
- **Foco:** Procedimentos prÃ¡ticos, passo-a-passo, equipamentos
- **Intro:** "Como calibrar {vehicle_full_name}"
- **FAQ:** "Como calibrar?", "Que equipamento usar?"

---

## **ğŸ—ï¸ ARQUIVOS PARA IMPLEMENTAR - FASE 1 (PRIMEIRO)**

### **1. SCHEDULE PARA CORREÃ‡ÃƒO `vehicle_data` (OTIMIZADO):**
```
Src/ContentGeneration/TirePressureGuide/Infrastructure/Console/Commands/Schedules/
â””â”€â”€ VehicleDataCorrectionSchedule.php
```

**EspecificaÃ§Ãµes:**
- **FrequÃªncia:** A cada 3 minutos
- **Processamento:** 1 veÃ­culo (2 artigos) por execuÃ§Ã£o
- **Rate limiting:** 180 segundos entre chamadas Claude
- **Model:** Claude 3 Haiku
- **Estimativa:** 965 veÃ­culos = 2 dias total
- **Economia:** 50% menos chamadas API

**LÃ³gica de seleÃ§Ã£o otimizada:**
```php
// Buscar prÃ³ximo veÃ­culo Ãºnico que precisa correÃ§Ã£o:
$firstArticle = TirePressureArticle::whereNull('vehicle_data_version')
    ->orWhere('vehicle_data_version', '!=', 'v2.1')
    ->orderBy('created_at', 'asc')
    ->first();

if ($firstArticle) {
    // Buscar AMBOS os artigos do mesmo veÃ­culo:
    $vehicleArticles = TirePressureArticle::where('vehicle_data.make', $firstArticle->vehicle_data['make'])
        ->where('vehicle_data.model', $firstArticle->vehicle_data['model'])
        ->where('vehicle_data.year', $firstArticle->vehicle_data['year'])
        ->get();
    
    // Processar os 2 artigos simultaneamente
}
```

### **2. SERVICE PARA CORREÃ‡ÃƒO:**
```
Src/ContentGeneration/TirePressureGuide/Application/Services/
â””â”€â”€ VehicleDataCorrectionService.php
```

**Responsabilidades:**
- Construir prompt para correÃ§Ã£o de dados estruturados
- Chamar Claude 3 Haiku com configuraÃ§Ãµes otimizadas
- Parsear resposta JSON corrigida
- Aplicar validaÃ§Ãµes bÃ¡sicas
- Salvar `vehicle_data` corrigido com flag de controle

### **3. COMMAND MANUAL PARA `vehicle_data`:**
```
Src/ContentGeneration/TirePressureGuide/Infrastructure/Console/Commands/
â””â”€â”€ CorrectVehicleDataCommand.php
```

**OpÃ§Ãµes:**
```bash
php artisan tire-pressure-guide:correct-vehicle-data 
    --make=Toyota               # Filtrar por marca
    --limit=50                  # NÃºmero mÃ¡ximo
    --dry-run                   # Preview sem executar
    --force                     # ForÃ§ar re-correÃ§Ã£o
```

### **4. CAMPOS DE CONTROLE PARA `vehicle_data`:**
```php
// Adicionar na TirePressureArticle:
'vehicle_data_corrected_at' => 'datetime',     // Quando foi corrigido
'vehicle_data_version' => 'string',            // VersÃ£o da correÃ§Ã£o (v2.1)
```

---

## **ğŸ—ï¸ ARQUIVOS PARA IMPLEMENTAR - FASE 2 (DEPOIS)**

### **1. SCHEDULE PARA REFINAMENTO SEÃ‡Ã•ES:**
```
Src/ContentGeneration/TirePressureGuide/Infrastructure/Console/Commands/Schedules/
â””â”€â”€ TirePressureRefinementSchedule.php
```

**EspecificaÃ§Ãµes:**
- **FrequÃªncia:** A cada 2 minutos
- **Processamento:** 1 artigo por execuÃ§Ã£o
- **Rate limiting:** 60 segundos entre chamadas Claude
- **Model:** Claude 3.5 Sonnet (qualidade premium)
- **Estimativa:** 60 artigos/dia = 32 dias total
- **Prerequisito:** `vehicle_data_version = 'v2.1'`

### **2. SERVICE DE REFINAMENTO:**
```
Src/ContentGeneration/TirePressureGuide/Application/Services/
â””â”€â”€ CompleteSectionRefinementService.php
```

**Responsabilidades:**
- Construir prompt baseado em `vehicle_data` + `template_type`
- Chamar Claude API com configuraÃ§Ãµes otimizadas
- Parsear resposta e extrair as 6 seÃ§Ãµes
- Salvar todas as seÃ§Ãµes de uma vez
- Marcar artigo como refinado

### **3. COMMAND MANUAL DE APOIO:**
```
Src/ContentGeneration/TirePressureGuide/Infrastructure/Console/Commands/
â””â”€â”€ RefineArticleSectionsCommand.php
```

**OpÃ§Ãµes:**
```bash
php artisan tire-pressure-guide:refine-sections 
    --template=ideal             # Filtrar por template
    --limit=50                   # NÃºmero mÃ¡ximo
    --make=Toyota               # Filtrar por marca
    --dry-run                   # Preview sem executar
    --force                     # ForÃ§ar re-refinamento
```

---

## **âš™ï¸ IMPLEMENTAÃ‡ÃƒO TÃ‰CNICA - FASE 1**

### **ğŸ”’ SISTEMA DE CONTROLE PARA `vehicle_data`:**

#### **LÃ³gica de seleÃ§Ã£o otimizada:**
```php
// Buscar prÃ³ximo veÃ­culo Ãºnico que precisa correÃ§Ã£o:
$vehicleGroup = TirePressureArticle::select('vehicle_data.make', 'vehicle_data.model', 'vehicle_data.year')
    ->whereNull('vehicle_data_version')
    ->orWhere('vehicle_data_version', '!=', 'v2.1')
    ->groupBy(['vehicle_data.make', 'vehicle_data.model', 'vehicle_data.year'])
    ->orderBy('created_at', 'asc')
    ->first();

if ($vehicleGroup) {
    // Buscar AMBOS os artigos do mesmo veÃ­culo:
    $vehicleArticles = TirePressureArticle::where('vehicle_data.make', $vehicleGroup['make'])
        ->where('vehicle_data.model', $vehicleGroup['model'])
        ->where('vehicle_data.year', $vehicleGroup['year'])
        ->get(); // Resultado: 2 artigos (ideal + calibration)
}
```

#### **MÃ©todo de correÃ§Ã£o simultÃ¢nea:**
```php
public function correctVehicleDataForBothArticles(array $vehicleArticles): bool
{
    // Pegar vehicle_data de qualquer um (sÃ£o idÃªnticos)
    $baseVehicleData = $vehicleArticles[0]->vehicle_data;
    
    // UMA chamada Claude para corrigir
    $correctedData = $this->claudeHaikuService->correctStructuredData($baseVehicleData);
    
    if ($correctedData) {
        // Aplicar nos DOIS artigos
        foreach ($vehicleArticles as $article) {
            $article->vehicle_data = $correctedData;
            $article->vehicle_data_corrected_at = now();
            $article->vehicle_data_version = 'v2.1';
            $article->save();
        }
        return true;
    }
    
    return false;
}
```

### **ğŸ¯ PROMPT PARA CLAUDE HAIKU:**

```php
$prompt = "
TAREFA: Corrigir e padronizar dados estruturados de veÃ­culo.

DADOS ATUAIS:
" . json_encode($this->vehicle_data, JSON_PRETTY_PRINT) . "

CORREÃ‡Ã•ES NECESSÃRIAS:
1. Gerar 'vehicle_full_name' = 'MARCA MODELO ANO'
2. Normalizar 'category_normalized' (Sedans, SUVs, Carros ElÃ©tricos, etc)
3. Criar 'pressure_display' = 'Dianteiros: X PSI / Traseiros: Y PSI'
4. Padronizar 'empty_pressure_display' = 'X/Y PSI'
5. Padronizar 'loaded_pressure_display' = 'X/Y PSI'
6. Definir 'is_premium' (BMW, Mercedes, Audi = true)
7. Definir 'has_tpms' (ano >= 2019 = true)
8. Definir 'vehicle_segment' (A, B, C, D)
9. Padronizar 'vehicle_type' ('car' ou 'motorcycle')

RETORNE APENAS JSON CORRIGIDO:
";
```

---

## **âš™ï¸ IMPLEMENTAÃ‡ÃƒO TÃ‰CNICA - FASE 2**

### **ğŸ”’ SISTEMA DE CONTROLE PARA SEÃ‡Ã•ES:**

#### **Prerequisito obrigatÃ³rio:**
```php
// SÃ“ refinar seÃ§Ãµes se vehicle_data foi corrigido:
$article = TirePressureArticle::whereNull('sections_last_refined_at')
    ->where('vehicle_data_version', 'v2.1')  // OBRIGATÃ“RIO!
    ->where('generation_status', 'generated')
    ->orderBy('created_at', 'asc')
    ->first();
```

#### **Campos de controle para seÃ§Ãµes:**
```php
// Adicionar na TirePressureArticle:
'sections_last_refined_at' => 'datetime',    // Quando foi refinado
'sections_refinement_version' => 'string',   // VersÃ£o do refinement (v2.0)
'refinement_status' => 'string',             // pending/processing/completed/failed
```

### **ğŸ¯ PROMPT STRUCTURE:**

#### **Template do prompt:**
```php
$prompt = "
DADOS DO VEÃCULO:
" . json_encode($article->vehicle_data, JSON_PRETTY_PRINT) . "

TEMPLATE: {$article->template_type}

CONTEÃšDO DE REFERÃŠNCIA:
" . json_encode($article->article_content, JSON_PRETTY_PRINT) . "

TAREFA: Gere 6 seÃ§Ãµes refinadas especÃ­ficas para este veÃ­culo:

1. sections_intro - IntroduÃ§Ã£o envolvente
2. sections_pressure_table - Tabela tÃ©cnica  
3. sections_how_to_calibrate - InstruÃ§Ãµes especÃ­ficas
4. sections_middle_content - Dicas e avisos
5. sections_faq - FAQ personalizada
6. sections_conclusion - ConclusÃ£o motivacional

RETORNE APENAS JSON com as 6 seÃ§Ãµes:
";
```

### **ğŸ”§ FLUXO DE PROCESSAMENTO:**

```php
// PseudocÃ³digo do fluxo:
1. $article = getNextArticleForRefinement()
2. $article->markAsProcessing()
3. $prompt = buildPrompt($article->vehicle_data, $article->template_type)
4. $response = claudeAPI->refine($prompt)
5. $sections = parseResponse($response)
6. $article->updateAllSections($sections)
7. $article->markAsRefinedComplete()
```

---

## **ğŸ“Š SISTEMA DE QUALIDADE E VALIDAÃ‡ÃƒO**

### **ğŸ¯ VALIDAÃ‡Ã•ES AUTOMÃTICAS:**

#### **ApÃ³s refinamento:**
```php
// Verificar se todas as seÃ§Ãµes foram preenchidas
$requiredSections = ['intro', 'pressure_table', 'how_to_calibrate', 'middle_content', 'faq', 'conclusion'];
$completeSections = 0;

foreach ($requiredSections as $section) {
    if (!empty($article->{"sections_$section"})) {
        $completeSections++;
    }
}

if ($completeSections === 6) {
    $article->refinement_status = 'completed';
    $article->sections_refinement_version = 'v2.0';
} else {
    $article->refinement_status = 'failed';
    // Agendar para retry
}
```

#### **CÃ¡lculo de score:**
```php
$qualityScore = 0;
foreach ($requiredSections as $section) {
    $content = $article->{"sections_$section"};
    if (!empty($content)) {
        $sectionScore = calculateSectionScore($content, $section);
        $qualityScore += $sectionScore;
    }
}
$overallScore = $qualityScore / 6; // Score mÃ©dio
```

---

## **âš¡ SCHEDULE CONFIGURATION**

### **ğŸ”„ Schedule Principal:**

```php
class TirePressureRefinementSchedule
{
    public function __invoke(Schedule $schedule): void
    {
        $schedule->call(function () {
            
            // ATOMIC LOCK - evita concorrÃªncia
            $lockKey = 'tire_pressure_refinement_v2';
            if (!Cache::lock($lockKey, 180)->get()) {
                return; // JÃ¡ estÃ¡ executando
            }
            
            try {
                $this->processSingleArticle();
            } finally {
                Cache::lock($lockKey, 180)->release();
            }
            
        })
        ->everyTwoMinutes()                    // SEGURO: 2 min entre execuÃ§Ãµes
        ->name('tire-pressure-refinement-v2')
        ->withoutOverlapping(180);             // 3 min sem sobreposiÃ§Ã£o
    }
    
    private function processSingleArticle(): void
    {
        $service = app(CompleteSectionRefinementService::class);
        
        // Buscar prÃ³ximo artigo
        $article = TirePressureArticle::getNextForRefinement();
        
        if ($article) {
            $success = $service->refineAllSections($article);
            
            Log::info("Artigo refinado", [
                'article_id' => $article->_id,
                'vehicle' => $article->vehicle_data['vehicle_full_name'] ?? 'N/A',
                'template' => $article->template_type,
                'success' => $success
            ]);
        }
    }
}
```

---

## **ğŸ“ˆ CRONOGRAMA COMPLETO DAS 2 FASES**

### **â±ï¸ FASE 1 - CorreÃ§Ã£o `vehicle_data` (OTIMIZADA):**

| MÃ©trica | Valor |
|---------|-------|
| **VeÃ­culos Ãºnicos** | 965 |
| **Artigos totais** | 1926 (2 por veÃ­culo) |
| **Chamadas Claude** | 965 (economia de 50%!) |
| **FrequÃªncia do schedule** | A cada 3 minutos |
| **VeÃ­culos por hora** | ~20 |
| **VeÃ­culos por dia** | ~480 |
| **Tempo total estimado** | 2 dias (nÃ£o 4!) |
| **Model Claude** | 3 Haiku |
| **Custo total** | ~$3 USD (nÃ£o $6!) |

### **â±ï¸ FASE 2 - Refinamento SeÃ§Ãµes (INALTERADA):**

| MÃ©trica | Valor |
|---------|-------|
| **Total de artigos** | 1926 (com vehicle_data corrigido) |
| **FrequÃªncia do schedule** | A cada 2 minutos |
| **Artigos por hora** | ~30 |
| **Artigos por dia** | ~60 (com rate limiting) |
| **Tempo total estimado** | 32 dias |
| **Model Claude** | 3.5 Sonnet |
| **Custo total** | ~$77 USD |

### **ğŸ“Š CRONOGRAMA TOTAL OTIMIZADO:**
- **Fase 1:** 2 dias (correÃ§Ã£o dados - OTIMIZADA!)
- **Fase 2:** 32 dias (refinamento seÃ§Ãµes)
- **Total:** 34 dias (nÃ£o 36!)
- **Custo total:** ~$80 USD ($3 + $77)

---

## **ğŸ” MONITORAMENTO E LOGS**

### **ğŸ“Š MÃ©tricas a acompanhar:**

```php
// EstatÃ­sticas em tempo real:
- Artigos processados hoje
- Artigos pendentes
- Taxa de sucesso
- Tempo mÃ©dio por artigo
- Erros recentes
- Estimativa de conclusÃ£o
```

### **ğŸš¨ Alertas automÃ¡ticos:**

```php
// CondiÃ§Ãµes de alerta:
- Taxa de erro > 10%
- Artigos travados > 2 horas
- Rate limit atingido frequentemente
- Fila muito grande (> 100 artigos)
```

---

## **ğŸ¯ PRÃ“XIMOS PASSOS - IMPLEMENTAÃ‡ÃƒO EM FASES**

### **ğŸ“‹ FASE 1 - Checklist (PRIMEIRO):**

1. âœ… **Implementar VehicleDataCorrectionSchedule**
   - Schedule a cada 3 minutos
   - Lock atÃ´mico para evitar concorrÃªncia
   - Processamento de 1 artigo por vez

2. âœ… **Criar VehicleDataCorrectionService**
   - MÃ©todo `correctVehicleData()`
   - Prompt builder para Claude 3 Haiku
   - Parser de resposta JSON
   - Rate limiting a cada 3 minutos

3. âœ… **Adicionar campos de controle na Model**
   - `vehicle_data_corrected_at`
   - `vehicle_data_version` (v2.1)

4. âœ… **Implementar CorrectVehicleDataCommand**
   - Command manual para teste e recovery
   - OpÃ§Ãµes de filtro e dry-run

5. âœ… **Sistema de validaÃ§Ã£o bÃ¡sica**
   - VerificaÃ§Ã£o se dados foram padronizados
   - Flag de controle para evitar reprocessamento

### **ğŸ“‹ FASE 2 - Checklist (DEPOIS DA FASE 1):**

1. âœ… **Implementar TirePressureRefinementSchedule**
   - Schedule a cada 2 minutos
   - **Prerequisito:** `vehicle_data_version = 'v2.1'`
   - Processamento de 1 artigo por vez

2. âœ… **Criar CompleteSectionRefinementService**
   - MÃ©todo `refineAllSections()`
   - Prompt builder baseado em `vehicle_data` corrigido + `template_type`
   - Parser de resposta JSON
   - Rate limiting a cada 60 segundos

3. âœ… **Adicionar campos de controle para seÃ§Ãµes**
   - `sections_last_refined_at`
   - `sections_refinement_version` (v2.0)
   - `refinement_status`

4. âœ… **Implementar RefineArticleSectionsCommand**
   - Command manual para teste e recovery
   - OpÃ§Ãµes de filtro e dry-run

5. âœ… **Sistema de validaÃ§Ã£o de qualidade**
   - VerificaÃ§Ã£o automÃ¡tica das 6 seÃ§Ãµes
   - CÃ¡lculo de score de qualidade
   - Recovery automÃ¡tico para falhas

### **ğŸ¯ Resultado Final Esperado:**

**APÃ“S FASE 1:**
- **1926 artigos** com **`vehicle_data` padronizado e corrigido**
- **Dados estruturados** consistentes e enriquecidos
- **Flags de controle** (`vehicle_data_version = 'v2.1'`)
- **Base sÃ³lida** para refinamento das seÃ§Ãµes

**APÃ“S FASE 2:**
- **1926 artigos** com **6 seÃ§Ãµes refinadas** cada
- **ConteÃºdo especÃ­fico** por veÃ­culo e template
- **Qualidade premium** via Claude 3.5 Sonnet
- **Sistema robusto** com recovery automÃ¡tico
- **Monitoramento completo** de progresso
- **Prontos para `PublishTempTirePressureArticlesCommand`**

---

## **ğŸ’¡ INFORMAÃ‡Ã•ES IMPORTANTES PARA O PRÃ“XIMO CHAT**

### **ğŸ”‘ Pontos CrÃ­ticos:**

1. **PRIMEIRA:** Corrigir `vehicle_data` com Claude 3 Haiku
2. **DEPOIS:** Refinar seÃ§Ãµes com Claude 3.5 Sonnet (usando dados corrigidos)
3. **NUNCA modificar `article_content`** - apenas seÃ§Ãµes
4. **Prerequisito obrigatÃ³rio:** `vehicle_data_version = 'v2.1'` para refinar seÃ§Ãµes
5. **Rate limiting diferenciado:** 3 min (Haiku) vs 1 min (Sonnet)
6. **ValidaÃ§Ã£o sequencial** - Fase 2 sÃ³ executa apÃ³s Fase 1
7. **Logs detalhados** para monitoramento de ambas as fases

### **ğŸ—ï¸ Arquitetura Existente:**
- Model `TirePressureArticle` jÃ¡ implementada
- Claude API service jÃ¡ existe (precisa configurar Haiku + Sonnet)
- Rate limiting jÃ¡ configurado (ajustar para 2 modelos)
- Sistema de backup jÃ¡ implementado

### **ğŸ¯ Objetivo Final:**
Criar sistema **100% automatizado** em **2 FASES SEQUENCIAIS**:
1. **Fase 1:** Padronizar `vehicle_data` (4 dias, Haiku, $6)
2. **Fase 2:** Refinar 6 seÃ§Ãµes (32 dias, Sonnet, $77)

**Total: 34 dias, $80 USD, QUALIDADE PREMIUM!** ğŸš€

**ECONOMIA ADICIONAL PELA OTIMIZAÃ‡ÃƒO:**
- âœ… **Tempo:** 2 dias a menos (34 vs 36)
- âœ… **Custo:** $3 a menos ($80 vs $83)  
- âœ… **API calls:** 965 a menos (50% economia na Fase 1)
- âœ… **EficiÃªncia:** MÃ¡xima pelo processamento simultÃ¢neo